---
title: "DenoでLinuxコマンドを作ろう"
emoji: "🐈ྀི"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Deno", "Linux", "command"]
published: false
---

# DenoでLinuxコマンドを作ろう

## はじめに
  れなっちと申します。<br>
  Web系エンジニア歴2年目で、現在はクライアントサイドを中心にTypeScript系を使った開発をしています。<br>
  好きなもの：アニメ・ねこ・ディズニー<br>
**この記事で学べること**<br>
  Linuxコマンドでの、キャッチアップの仕方<br>
  Denoの初歩的な書き方<br>
**対象読者と前提知識**<br>
  Denoを触ってみたい人<br>
  環境構築を程々にTypeScriptをちょっと書いてみたい方<br>
  TypeScriptのキャッチアップしたい人<br>

## 第1章: Denoの基礎

### 1.1 Denoとは - Node.jsとの違いを理解する
- **DenoとNode.jsは**<br>
    > 「Node.jsに関する10の反省点」を修正すべく、Node.jsの開発者でもあるRyan Dahl氏を中心に開発が行われています。<br>
    Node.jsは現在の開発にはなくてはならない存在です。<br>
    それだけ使用されているツールの反省点が10個もあること・そしてその反省点を活かしてDenoが開発されていることは根幹に関わることなので認識して触ると触りやすく面白いです。<br>
  - TypeScript標準サポート<br>
    コンパイルをしなくてもTypeScriptが実行できます。設定や追加の手順は、一切不要なので、とっても簡単に扱うことができます。<br>
    TypeScriptのキャッチアップに最適な環境と言えると思います。<br>
  - Denoのpermissions<br>
    Denoは、明示的に権限を与えない限り実行することができません。今回の実装内容は、かなり強力なものです。ファイル作成や内容の上書きをDenoにさせるためには、コマンドの意味を理解して権限を与えることができる人しか実行できません。これは、さまざまな事故を未然に防ぐ役割があります。<br>
    また、npmの脆弱性が増えてきているようです。その結果、サプライチェーン攻撃の標的になったりしています<br>Denoは、そのような攻撃に強くなっています<br>

### 1.2 開発環境のセットアップ
- Denoのインストール<br>
 公式こそ正義です。公式URLを参考に行ってください<br>
 私はmiseで入れました。ご自身のお使いのバージョン管理ツールに合った方法をお使いください！<br>

### 1.3 catコマンドの作成
- 最初のコマンド作成<br>
  1. まず、最初のコマンドとして、catコマンドを作成してみましょう！<br>
  2. Unix cat：URL(https://docs.deno.com/examples/unix_cat/) を検索してください。<br>
  3. ブラウザに書いてるコードをコピーしてください。<br>
  4. お好きなコードエディタで開いたDenoのリポジトリに`cat.ts`を作成して先ほどコピーしてきたコードを貼り付けてください。<br>
  5. これで完成です！<br>
- 実行方法
  ```
  % deno run cat.ts　cat.ts
  ```
  を実行してください。<br>
  以下の文が出たと思います。<br>
  ```
  % deno run cat.ts cat.ts
  ┏ ⚠️  Deno requests read access to "cat.ts".
  ┠─ Requested by `Deno.open()` API.
  ┠─ To see a stack trace for this prompt, set the DENO_TRACE_PERMISSIONS environmental variable.
  ┠─ Learn more at: https://docs.deno.com/go/--allow-read
  ┠─ Run again with --allow-read to bypass this prompt.
  ┗ Allow? [y/n/A] (y = yes, allow; n = no, deny; A = allow all read permissions) >
  ```
- 権限システムの理解<br>
  読み取り権限に許可を求めていることが分かります。<br>
  これが「1.1　Denoのpermissions」に記述してある内容です。<br>
  許可を渡すことでスクリプトが実行されます。<br>
  デフォルトでは、ほとんどのシステムI/Oへのアクセスは拒否されます。<br>
  ただし、ユーザーがDenoランタイムに明示的に権限を付与することでアクセスをすることができます。<br>
  許可には、下記表に記載しました。
  |オプション  |許可内容  |
  |---|---|
  |--allow-read  |読み込み許可 |
  |--allow-write |書き込み許可 |
  |--allow-net  |ネットワークアクセスを許可 |
  |--allow-env  |環境変数の取得や設定などの環境アクセスを許可 |
  |--allow-run  |サブプロセスの実行を許可 |
  |--allow-all  |全ての許可 |

- 再度実行<br>
```
% Deno run --allow-read cat.ts cat.ts

@@@@@ FsFile {}
for (const filename of Deno.args) {
    const file = await Deno.open(filename);
    console.log("@@@@@", file);
    await file.readable.pipeTo(Deno.stdout.writable, { preventClose: true });
}%
```
  スクリプトが実行されました！

## 第2章: Linuxコマンドの実装

### 2.1 ファイル操作コマンド `touch` の実装<br>
実際のコードはGitHubのURLを参考に確認してください。<br>
https://github.com/kashiwagi-rena/LinuxCommand/blob/main/touch.ts<br>
- 超個人的なLinuxコマンドの調べ方
　調べるよりも実際に動かした方が、真似したい挙動になると思い、コツコツ確認していきました。<br>
  1. IBMの公式を確認。<br>
  参考URL：https://www.ibm.com/docs/ja/aix/7.1.0?topic=t-touch-command<br>
  2. 実行して、挙動の確認<br>
  3. エラー文の確認と自分このコマンドを使う時にどんなエラー文がでたら嬉しいかを検討する。<br>
　


- Denoの標準ライブラリ
```

```
参考：https://deno-ja.vercel.app/manual@v1.8.3/standard_library

- エラーハンドリング
```

```

### 2.2 テキスト検索コマンド `cat_footsteps` の実装
- 正規表現での検索機能
- 行番号表示オプション
- 複数ファイルでの検索
- パフォーマンス最適化

## 第3章: 品質向上とデプロイメント

### 3.1 テストとデバッグ
- 単体テストの書き方
- Deno標準のテスト機能
- デバッグ手法とツール

### 3.2 配布可能な実行ファイル作成
- `deno compile`での単一実行ファイル生成
- クロスプラットフォーム対応
- システムへのインストール方法
- PATH設定とエイリアス

## まとめ
- Denoでのコマンド開発の利点
- さらなる学習リソース
- コミュニティとエコシステム

## 付録
- 完成したコマンドのソースコード一覧
- よくあるエラーと対処法
- 参考リンク集